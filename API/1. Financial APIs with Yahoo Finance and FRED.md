# Python Hands-on Tutorial 
## Financial APIs with Yahoo Finance and FRED

---

## 1. Learning Objectives

By the end of this tutorial, you will be able to:

- retrieve daily market data using the Yahoo Finance API;
- retrieve macroeconomic indicators from the FRED database;
- clean and align financial and macroeconomic time series;
- compute returns and volatility measures;
- combine market and macro data for simple empirical analysis.

This tutorial focuses on **practical API usage** and **data handling**, rather than advanced financial modeling.

---

## 2. Required Packages 

We use standard Python libraries commonly adopted in financial data analysis.

!pip install yfinance pandas_datareader pandas matplotlib statsmodels


## 3. Import Libraries and Basic Setup
```
import pandas as pd
import numpy as np
import yfinance as yf
from pandas_datareader import data as pdr

import matplotlib.pyplot as plt
import statsmodels.api as sm

pd.set_option("display.max_columns", 20)
```
## 4. Market Data via Yahoo Finance API
### 4.1 Download Daily Price Data
```
ticker = "SPY"
start = "2015-01-01"
end   = "2025-12-31"

df_px = yf.download(ticker, start=start, end=end, auto_adjust=False)
df_px.head()

```


Typical columns include:
- Open
- High
- Low
- Close
- Adjusted Close
- Trading Volume


## 4.2 Compute Log Returns

Adjusted prices are preferred because they account for dividends and stock splits.

```python
px = df_px["Adj Close"].rename("spy_adjclose").to_frame()
px["r_spy"] = np.log(px["spy_adjclose"]).diff()
px = px.dropna()
px.head()

```
Why log returns?
- additive over time
- standard in empirical finance
- convenient for volatility and risk analysis

## 4.3 Visualization
```
px["spy_adjclose"].plot(title="SPY Adjusted Close")
plt.show()

px["r_spy"].plot(title="SPY Daily Log Returns")
plt.show()
```
Discussion
- Why does the price series look smooth?
- Do you observe volatility clustering in returns?

## 5. A Simple Volatility Measure
A basic volatility proxy is the rolling standard deviation of daily returns.
```
window = 21  # approximately one trading month
px["vol_1m"] = px["r_spy"].rolling(window).std() * np.sqrt(252)
px["vol_1m"].plot(
    title="SPY 1-Month Rolling Volatility (Annualized)"
)
plt.show()
```
Remark
- This is a descriptive volatility measure, not a parametric model such as GARCH.

## 6. Macroeconomic Data via FRED API
We retrieve macroeconomic data from the Federal Reserve Economic Data (FRED) database.
This approach does not require an API key.

## 6.1 Download Macroeconomic Series

Commonly used series:
- **CPIAUCSL**: Consumer Price Index  
- **FEDFUNDS**: Effective Federal Funds Rate  

```python
start = "2015-01-01"
end   = "2025-12-31"

cpi = pdr.DataReader("CPIAUCSL", "fred", start, end)
ffr = pdr.DataReader("FEDFUNDS", "fred", start, end)

cpi.tail()
```

## 6.2 Transform Macroeconomic Variables
CPI is a level index, so we convert it to an inflation rate.

```
cpi = cpi.rename(columns={"CPIAUCSL": "cpi"})
ffr = ffr.rename(columns={"FEDFUNDS": "ffr"})

cpi["infl_m"] = np.log(cpi["cpi"]).diff()
ffr["ffr_dec"] = ffr["ffr"] / 100.0

macro = cpi[["infl_m"]].join(
    ffr[["ffr_dec"]],
    how="outer"
)

macro.tail()
```

## 7. Aligning Market and Macro Data
Market data are daily, while macroeconomic data are usually monthly. A common practical solution is to forward-fill macro variables.
```
macro_daily = macro.resample("B").ffill()

data = px.join(macro_daily, how="inner")
data.head()
```

## 8. Simple Regression Example (Daily Frequency)

We illustrate how macro variables can be merged with market returns.
```
df = data[["r_spy", "infl_m", "ffr_dec"]].dropna()

Y = df["r_spy"]
X = df[["infl_m", "ffr_dec"]]
X = sm.add_constant(X)

model = sm.OLS(Y, X).fit()
print(model.summary())
```

Interpretation
- Daily returns are noisy
- Economic interpretation at daily frequency is limited

## 9. Monthly Aggregation (More Economically Meaningful)
We aggregate daily returns to monthly returns.
```
r_m = px["r_spy"].resample("M").sum().rename("r_spy_m")
macro_m = macro.resample("M").last()

df_m = pd.concat(
    [r_m, macro_m[["infl_m", "ffr_dec"]]],
    axis=1
).dropna()

df_m.head()
```
Monthly Regression
```
Y = df_m["r_spy_m"]
X = sm.add_constant(
    df_m[["infl_m", "ffr_dec"]]
)

model_m = sm.OLS(Y, X).fit()
print(model_m.summary())
```

## 10. Visualization: Market and Macro Variables
```
df_m[["r_spy_m", "infl_m", "ffr_dec"]].plot(
    title="Monthly Market Returns and Macroeconomic Variables"
)
plt.show()
```

## 11. Creating Reusable Functions (Mini Data Pipeline)
```
def get_yf_returns(ticker, start, end):
    df = yf.download(ticker, start=start, end=end)
    px = df["Adj Close"].rename("adjclose").to_frame()
    px["r"] = np.log(px["adjclose"]).diff()
    return px.dropna()

def get_fred_macro(start, end):
    cpi = pdr.DataReader(
        "CPIAUCSL", "fred", start, end
    ).rename(columns={"CPIAUCSL": "cpi"})
    ffr = pdr.DataReader(
        "FEDFUNDS", "fred", start, end
    ).rename(columns={"FEDFUNDS": "ffr"})

    cpi["infl_m"] = np.log(cpi["cpi"]).diff()
    ffr["ffr_dec"] = ffr["ffr"] / 100.0

    return cpi[["infl_m"]].join(
        ffr[["ffr_dec"]],
        how="outer"
    )
```












